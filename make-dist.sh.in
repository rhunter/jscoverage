#!/bin/sh

set -e

version=@VERSION@
distdir=jscoverage-${version}
distfile=${distdir}.tar.bz2

rm -fr $distdir
mkdir $distdir

# copy all files in SVN
for file in $(svn ls -R -r HEAD)
do
  if [ -f "$file" ]
  then
    cp -a --parents "$file" $distdir
  fi
done

# add generated files
cp -a --parents Makefile.in aclocal.m4 configure depcomp install-sh missing $distdir
cp -a --parents tests/Makefile.in $distdir
cp -a --parents doc/instrumented $distdir
cp -a --parents doc/instrumented-inverted $distdir

# remove unnecessary files
rm $distdir/TIMESTAMP
rm $distdir/bootstrap.sh
rm -r $distdir/scriptaculous*

timestamp=`cat TIMESTAMP`
find $distdir -exec touch -d "$timestamp" {} \;

BZIP2=--best tar jcvf $distfile --numeric-owner --owner=0 --group=0 --exclude=.svn $distdir
